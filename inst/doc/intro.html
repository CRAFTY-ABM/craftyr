<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Sascha Holzhauer" />

<meta name="date" content="2015-08-13" />

<title>Introduction to craftyr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to craftyr</h1>
<h4 class="author"><em>Sascha Holzhauer</em></h4>
<h4 class="date"><em>2015-08-13</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#concept">Concept</a><ul>
<li><a href="#directory-structure">Directory Structure</a></li>
<li><a href="#parameters">Parameters</a><ul>
<li><a href="#defining-colours">Defining Colours</a></li>
</ul></li>
</ul></li>
<li><a href="#debugginglogging">Debugging/Logging</a></li>
<li><a href="#handling-data">Handling Data</a><ul>
<li><a href="#storing-data">Storing Data</a></li>
<li><a href="#using-craftyr-to-put-custom-plots-in-the-right-place">Using craftyr to Put Custom Plots in the Right Place</a></li>
<li><a href="#comparing-data">Comparing Data</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#error-messages">Error Messages</a></li>
</ul></li>
</ul>
</div>

<div id="concept" class="section level1">
<h1>Concept</h1>
<p>The package provides various functions to load data from model output, convert, and finally visualise it. Therefore, in a chain of production these functions need to be combined. At the same time, there are a number of high level functions which integrate the more basic functions but leave less scope for customisation. These high level functions start with hl.</p>
<div id="directory-structure" class="section level2">
<h2>Directory Structure</h2>
<p>The package assumes that you stick to the recommended directory structure for both input and output data. See <a href="https://www.wiki.ed.ac.uk/display/CRAFTY/Filename+Substitution+and+Recommended+Folder+Structure">here</a> for a definition. However, if you need to change that structure, craftyr provides some mean to adjust pre-defined values. For instance, you may implement a custom function and assign it to <code>simp$dirs$param$getparamdir</code>.</p>
</div>
<div id="parameters" class="section level2">
<h2>Parameters</h2>
<p>There is a simp (SIMulation Properties) list which contains all project-specific properties, directories, and parameters. The basic idea is to define a simp list for each project and execute the simp defining R code every time you start a script with the according project. Within the script, “local” properties can overwrite the project level settings, e.g. runID, image resolutions etc.</p>
<p>Since some paths vary according to the machine that executes the R code, the simp list is created from two parts: A machine-specific part and a general, machine-independent part.</p>
<pre class="sourceCode r"><code class="sourceCode r">###############################################################################
<span class="co"># Machine=specific SIMP definition</span>
<span class="co"># NOTE: Changes in super-level parameters that are used to derive further</span>
<span class="co"># parameters need to trigger a re-evaluation of the derived parameters!</span>
### Environment ###############################################################
<span class="co"># craftyr demo</span>
### Remove existing definition ################################################
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>(<span class="dt">all=</span><span class="ot">TRUE</span>))
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>(<span class="dt">all=</span><span class="ot">TRUE</span>, <span class="dt">envir=</span><span class="kw">globalenv</span>()), <span class="dt">envir=</span><span class="kw">globalenv</span>())
<span class="kw">library</span>(craftyr)
#### Set path to itself #######################################################
simp &lt;-<span class="st"> </span><span class="kw">list</span>()
simp$simpDefinition &lt;-<span class="st"> &quot;../demo/simp-machine.R&quot;</span>
#### Load project default SIMP ################################################
<span class="kw">source</span>(<span class="st">&quot;../demo/simp.R&quot;</span>)
#### Merge crafty default SIMP ################################################
simp &lt;-<span class="st"> </span><span class="kw">param_mergeDefaultSimp</span>(simp)

### Directories ###############################################################

simp$dirs &lt;-<span class="st"> </span><span class="kw">list</span>()
simp$dirs$project           &lt;-<span class="st"> &quot;C:/Data/LURG/workspace/CRAFTY_ConsVis-ToyWorld/&quot;</span>
simp$dirs$data              &lt;-<span class="st"> </span><span class="kw">paste</span>(simp$dirs$project, <span class="st">&quot;data/&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
simp$dirs$outputdir         &lt;-<span class="st"> &quot;C:/Data/LURG/Projects/Volante/Output/&quot;</span>
simp$dirs$simp              &lt;-<span class="st"> </span><span class="kw">paste</span>(simp$dirs$project, <span class="st">&quot;./config/R/&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
[...]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">################################################################
<span class="co"># General SIMulation Properties:</span>
################################################################
if (!<span class="kw">exists</span>(<span class="st">&quot;simp&quot;</span>)) simp &lt;-<span class="st"> </span><span class="kw">list</span>()
simp$sim &lt;-<span class="st"> </span><span class="kw">list</span>()
simp$sim$worldname              &lt;-<span class="st"> &quot;ToyWorld&quot;</span>
simp$sim$version                &lt;-<span class="st"> &quot;V001&quot;</span>
simp$sim$allocversion           &lt;-<span class="st"> &quot;V001AllocGen&quot;</span>
simp$sim$scenario               &lt;-<span class="st"> &quot;Scenario&quot;</span>
[...]</code></pre>
<p>The machine-specific simp part in an according script (simp-&lt;machine&gt;.R) contains the (machine-specific) path to itself and to the machine-independent simp part script (simp.R), loads that general part and may overwrite certain parameters. It also merges the defined parameters in the general crafyr default parameter list to apply craftyr defaults when no other specification is given.</p>
<p>Using the parameter set during an initial execution of the machine-dependent scripts at startup, each script using craftyr should load the simp code anew. During that process, the entire simp list including all possible changes are removed from memory and loaded anew.</p>
<p>The simp list consists of a number of sublists:</p>
<ul>
<li><p>sim</p></li>
<li><p>dirs</p></li>
<li><p>csv</p></li>
<li><p>mdata</p></li>
<li><p>fig</p></li>
<li><p>debug</p></li>
</ul>
<div id="defining-colours" class="section level3">
<h3>Defining Colours</h3>
<p>Craftyr functions take colour set names which are passed to the generic colour setting function to obtain sets of colours (simp<span class="math">\(colours\)</span>GenericFun). The function is implemented in crafty and maps common colour sets (AFT, Capitals, Services, Regions, Runids, binary colour set for e.g. adoption) to colour sets defined via particular simp parameters (e.g. simp<span class="math">\(colours\)</span>AFT). Therefore, there are two ways to influence colour settings:</p>
<ul>
<li><p>change the assignment to specific colour sets (simp<span class="math">\(colours\)</span><Set>)</p></li>
<li><p>change the assignment for the generic colour setting function, using your own implementation that may deal with defined colour set names in a specific, dynamic way.</p></li>
</ul>
</div>
</div>
</div>
<div id="debugginglogging" class="section level1">
<h1>Debugging/Logging</h1>
<p>Craftyr uses the package ‘futile.logger’. Initially, it sets up a console outputter to log everything on INFO level. However, the logger can be configured in a detailed way.</p>
<pre class="sourceCode r"><code class="sourceCode r">futile.logger::<span class="kw">flog.threshold</span>(futile.logger::DEBUG, <span class="dt">name=</span><span class="st">'crafty'</span>)
futile.logger::<span class="kw">flog.threshold</span>(futile.logger::TRACE, <span class="dt">name=</span><span class="st">'crafty.input'</span>)</code></pre>
<p>It is also possible to add handlers for further sinks.</p>
<pre class="sourceCode r"><code class="sourceCode r">futile.logger::<span class="kw">flog.appender</span>(<span class="kw">appender.file</span>(filename), <span class="dt">name=</span><span class="st">'test.logger'</span>)</code></pre>
<p>Compare the documentation for package ‘futile.logger’ for more detailed information. A tutorial is also <a href="http://www.r-bloggers.com/better-logging-in-r-aka-futile-logger-1-3-0-released/">available</a>.</p>
</div>
<div id="handling-data" class="section level1">
<h1>Handling Data</h1>
<div id="storing-data" class="section level2">
<h2>Storing Data</h2>
<p>Raster output data from the model could involve many files of considerable size. Therefore, it is a good idea to store processed and aggregated data for further use. R provides the possibility of storing R objects into a file.</p>
<p>To make use of that feature, input routines should write the resulting R object to disk, and processing and visualisation routines shall load it from disk again. This way, the input routine only needs to performed once unless the raw data changes. Crucial is a consistent naming of R objects! To manage data it is possible to assign an ID during storage, which is added to the filename. This way it is possible to use the same script (which uses specific names for objects) with multiple data. Also make sure that IDs make clear what data is stored (e.g. regions, scenarios) since there is currently no mechanism to check whether loaded data corresponds to current SIMP settings.</p>
<pre class="sourceCode r"><code class="sourceCode r">csv_LandUseIndex_rbinded &lt;-<span class="st"> </span>data
<span class="kw">input_tools_save</span>(simp, <span class="st">&quot;csv_LandUseIndex_rbinded&quot;</span>)
<span class="kw">rm</span> (csv_LandUseIndex_rbinded)</code></pre>
<p>To load an object to the global environment again, just execute</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">input_tools_load</span>(simp, <span class="st">&quot;csv_LandUseIndex_rbinded&quot;</span>)</code></pre>
</div>
<div id="using-craftyr-to-put-custom-plots-in-the-right-place" class="section level2">
<h2>Using craftyr to Put Custom Plots in the Right Place</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="dt">package=</span><span class="st">&quot;craftyr&quot;</span>)
<span class="kw">source</span>(<span class="st">&quot;../demo/simp-machine.R&quot;</span>)
simp$fig$<span class="kw">init</span>(simp, <span class="dt">filename =</span> <span class="st">&quot;example/hist_aft.png&quot;</span>)
<span class="kw">hist</span>(cellData$LandUseIndex, <span class="dt">breaks=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
<span class="kw">dev.off</span>()</code></pre>
</div>
<div id="comparing-data" class="section level2">
<h2>Comparing Data</h2>
<p>The generic way of comparing data of several sources, i.e. combining the data to visualise in one plot, is the following:</p>
<ol style="list-style-type: decimal">
<li>For each data set to compare
<ul>
<li>Load data</li>
<li>Edit Runid</li>
</ul></li>
<li>Combine data</li>
<li>Save data with a new simp (new id/new output folder)</li>
<li>Use the new dataname with the new simp (includes the new id and folder) to apply a function as normal</li>
</ol>
<p>However, there a few high level functions that take a list of simp configurations and do not require the storage of combined data:</p>
<ul>
<li>hl_comp_aggregate_aftcompositions</li>
<li>hl_comp_cell_aftcomposition</li>
</ul>
</div>
</div>
<div id="troubleshooting" class="section level1">
<h1>Troubleshooting</h1>
<div id="error-messages" class="section level2">
<h2>Error Messages</h2>
<pre class="sourceCode r"><code class="sourceCode r">Error in if (simp$fig$plottitle &gt;<span class="st"> </span><span class="dv">0</span>) { :<span class="st"> </span>argument is of length zero</code></pre>
<p>Such an error message indicates a missing component in SIMP. Usually, the custom configuration assigned new lists to a super-component, erasing the orignal (default) content of that super-compomnent. Therefore, make sure your custom configuration does not assign new lists unchecked (ie. without checking <code>if (is.null(simp$sim)) simp$sim &lt;- list()</code>.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
